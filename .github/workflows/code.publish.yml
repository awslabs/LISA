name: Publish LISA NPM Package
on:
  release:
    types: [released]

permissions:
  contents: read
  packages: write

jobs:
  PublishLISA:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
      # Setup .npmrc file to publish to GitHub Packages
      - uses: actions/setup-node@1e60f620b9541d16bece96c5465dc8ee9832be0b # v4.0.3
        with:
          node-version: '20.x'
          registry-url: 'https://npm.pkg.github.com'
      - run: npm ci
      - run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  SendSlackNotification:
    name: Send Slack Notification
    needs: [ PublishLISA ]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Send Notification that package has published
        uses: rtCamp/action-slack-notify@4e5fb42d249be6a40e8ac1e7cdefc3e00b9f43c9 # v2.3.0
        env:
          SLACK_WEBHOOK: ${{ secrets.INTERNAL_DEV_SLACK_WEBHOOK_URL }}
          SLACK_COLOR: ${{ contains(join(needs.*.result, ' '), 'failure') && 'failure' || 'success' }}
          SLACK_TITLE: 'NPM Package Published'
          SLACK_FOOTER: ''
          MSG_MINIMAL: 'actions url,commit'
          SLACK_MESSAGE_ON_FAILURE: '<!here> NPM Package publish FAILED for version  ${{ github.event.pull_request.head.ref }}|commit>'
          SLACK_MESSAGE_ON_SUCCESS: 'NPM Package published SUCCESS for ${{ github.event.pull_request.head.ref }}|commit>.'
          SLACK_MESSAGE: 'NPM Publish Finished with status ${{ job.status }} for <${{ github.event.pull_request.head.ref }}|commit>'
