{
  "Transform": "AWS::SecretsManager-2024-09-16",
  "Parameters": {
    "LisaServeResourcesLisaServeResourcesmanagementKeyStringParameterParameterAD609E8A": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/appManagementKeySecretName"
    },
    "TokenTableNameParameterParameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/tokenTableName"
    },
    "SsmParameterValueawsserviceecsoptimizedamiamazonlinux2recommendedimageidC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>",
      "Default": "/aws/service/ecs/optimized-ami/amazon-linux-2/recommended/image_id"
    },
    "SsmParameterValuedevtestlisalisarolesRESTC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/roles/REST"
    },
    "SsmParameterValuedevtestlisalisarolesRESTEXC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/roles/RESTEX"
    },
    "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/roles/MCPWORKBENCH"
    },
    "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHEXC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/roles/MCPWORKBENCHEX"
    },
    "BootstrapVersion": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
    }
  },
  "Resources": {
    "GuardrailsTableCEF5B750": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "guardrailId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "modelId",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "ModelIdIndex",
            "KeySchema": [
              {
                "AttributeName": "modelId",
                "KeyType": "HASH"
              },
              {
                "AttributeName": "guardrailId",
                "KeyType": "RANGE"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "guardrailId",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "modelId",
            "KeyType": "RANGE"
          }
        ],
        "SSESpecification": {
          "SSEEnabled": true
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "GuardrailsTableNameParameter26CA9DE7": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/guardrailsTableName",
        "Type": "String",
        "Value": {
          "Ref": "GuardrailsTableCEF5B750"
        }
      }
    },
    "RestApiECSClustertestlisadevClC04148B6": {
      "Type": "AWS::ECS::Cluster",
      "Properties": {
        "ClusterName": "test-lisa-dev-REST",
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevClF05BDFDE": {
      "Type": "AWS::ECS::ClusterCapacityProviderAssociations",
      "Properties": {
        "CapacityProviders": [
          {
            "Ref": "RestApiECSClustertestlisadevAsgCapacityProviderF18999A7"
          }
        ],
        "Cluster": {
          "Ref": "RestApiECSClustertestlisadevClC04148B6"
        },
        "DefaultCapacityProviderStrategy": []
      }
    },
    "RestApiECSClusterRestAsgSecurityGroup6583A565": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "LisaServe/RestApi-ECSCluster/RestAsgSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "RestApiECSClusterRestAsgSecurityGroupfromLisaNetworkingVpcRestApiAlbSgA916BD54ALLPORTS37A86A5D": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "Description": "from LisaNetworkingVpcRestApiAlbSgA916BD54:ALL PORTS",
        "FromPort": 0,
        "GroupId": {
          "Fn::GetAtt": [
            "RestApiECSClusterRestAsgSecurityGroup6583A565",
            "GroupId"
          ]
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcRestApiAlbSg469AE4F8GroupIdDB418565"
        },
        "ToPort": 65535
      }
    },
    "RestApiECSClustertestlisadevASGInstanceRole4F18B1DE": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ec2.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/CloudWatchLogsFullAccess"
              ]
            ]
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/AmazonSSMFullAccess"
              ]
            ]
          }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGInstanceRoleDefaultPolicy763E7201": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecs:DeregisterContainerInstance",
                "ecs:RegisterContainerInstance",
                "ecs:Submit*"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RestApiECSClustertestlisadevClC04148B6",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "ecs:Poll",
                "ecs:StartTelemetrySession"
              ],
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "RestApiECSClustertestlisadevClC04148B6",
                      "Arn"
                    ]
                  }
                }
              },
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "ecs:DiscoverPollEndpoint",
                "ecr:GetAuthorizationToken",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RestApiECSClustertestlisadevASGInstanceRoleDefaultPolicy763E7201",
        "Roles": [
          {
            "Ref": "RestApiECSClustertestlisadevASGInstanceRole4F18B1DE"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGInstanceProfile5F0036EC": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Roles": [
          {
            "Ref": "RestApiECSClustertestlisadevASGInstanceRole4F18B1DE"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGLaunchConfigD5B6F73C": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "BlockDeviceMappings": [
          {
            "DeviceName": "/dev/xvda",
            "Ebs": {
              "Encrypted": true,
              "VolumeSize": 50
            }
          }
        ],
        "IamInstanceProfile": {
          "Ref": "RestApiECSClustertestlisadevASGInstanceProfile5F0036EC"
        },
        "ImageId": {
          "Ref": "SsmParameterValueawsserviceecsoptimizedamiamazonlinux2recommendedimageidC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "InstanceMonitoring": true,
        "InstanceType": "m5.large",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "RestApiECSClusterRestAsgSecurityGroup6583A565",
              "GroupId"
            ]
          }
        ],
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash\necho ECS_CLUSTER=",
                {
                  "Ref": "RestApiECSClustertestlisadevClC04148B6"
                },
                " >> /etc/ecs/ecs.config\nsudo iptables --insert FORWARD 1 --in-interface docker+ --destination 169.254.169.254/32 --jump DROP\nsudo service iptables save\necho ECS_AWSVPC_BLOCK_IMDS=true >> /etc/ecs/ecs.config"
              ]
            ]
          }
        }
      },
      "DependsOn": [
        "RestApiECSClustertestlisadevASGInstanceRoleDefaultPolicy763E7201",
        "RestApiECSClustertestlisadevASGInstanceRole4F18B1DE"
      ]
    },
    "RestApiECSClustertestlisadevASGCAE610D7": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "AutoScalingGroupName": "test-lisa-dev-REST",
        "Cooldown": "60",
        "DefaultInstanceWarmup": 60,
        "LaunchConfigurationName": {
          "Ref": "RestApiECSClustertestlisadevASGLaunchConfigD5B6F73C"
        },
        "MaxSize": "5",
        "MetricsCollection": [
          {
            "Granularity": "1Minute"
          }
        ],
        "MinSize": "1",
        "Tags": [
          {
            "Key": "Name",
            "PropagateAtLaunch": true,
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ],
        "VPCZoneIdentifier": [
          {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
          },
          {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
          }
        ]
      },
      "UpdatePolicy": {
        "AutoScalingRollingUpdate": {
          "SuspendProcesses": [
            "HealthCheck",
            "ReplaceUnhealthy",
            "AZRebalance",
            "AlarmNotification",
            "ScheduledActions",
            "InstanceRefresh"
          ]
        },
        "AutoScalingScheduledAction": {
          "IgnoreUnmodifiedGroupSizeProperties": true
        }
      }
    },
    "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRole63B8BEE5": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRoleDefaultPolicy95F8B781": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ec2:DescribeInstances",
                "ec2:DescribeInstanceAttribute",
                "ec2:DescribeInstanceStatus",
                "ec2:DescribeHosts"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "autoscaling:CompleteLifecycleAction",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":autoscaling:us-iso-east-1:012345678901:autoScalingGroup:*:autoScalingGroupName/",
                    {
                      "Ref": "RestApiECSClustertestlisadevASGCAE610D7"
                    }
                  ]
                ]
              }
            },
            {
              "Action": [
                "ecs:DescribeContainerInstances",
                "ecs:DescribeTasks"
              ],
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "RestApiECSClustertestlisadevClC04148B6",
                      "Arn"
                    ]
                  }
                }
              },
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "ecs:ListContainerInstances",
                "ecs:SubmitContainerStateChange",
                "ecs:SubmitTaskStateChange"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RestApiECSClustertestlisadevClC04148B6",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "ecs:UpdateContainerInstancesState",
                "ecs:ListTasks"
              ],
              "Condition": {
                "ArnEquals": {
                  "ecs:cluster": {
                    "Fn::GetAtt": [
                      "RestApiECSClustertestlisadevClC04148B6",
                      "Arn"
                    ]
                  }
                }
              },
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRoleDefaultPolicy95F8B781",
        "Roles": [
          {
            "Ref": "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRole63B8BEE5"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGDrainECSHookFunctionB9703624": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "ZipFile": "import boto3, json, os, time\n\necs = boto3.client('ecs')\nautoscaling = boto3.client('autoscaling')\n\n\ndef lambda_handler(event, context):\n  print(json.dumps(dict(event, ResponseURL='...')))\n  cluster = os.environ['CLUSTER']\n  snsTopicArn = event['Records'][0]['Sns']['TopicArn']\n  lifecycle_event = json.loads(event['Records'][0]['Sns']['Message'])\n  instance_id = lifecycle_event.get('EC2InstanceId')\n  if not instance_id:\n    print(f\"Got event without EC2InstanceId: { json.dumps(dict(event, ResponseURL='...')) }\")\n    return\n\n  instance_arn = container_instance_arn(cluster, instance_id)\n  print('Instance %s has container instance ARN %s' % (lifecycle_event['EC2InstanceId'], instance_arn))\n\n  if not instance_arn:\n    return\n\n  task_arns = container_instance_task_arns(cluster, instance_arn)\n\n  if task_arns:\n    print('Instance ARN %s has task ARNs %s' % (instance_arn, ', '.join(task_arns)))\n\n  while has_tasks(cluster, instance_arn, task_arns):\n    time.sleep(10)\n\n  try:\n    print('Terminating instance %s' % instance_id)\n    autoscaling.complete_lifecycle_action(\n        LifecycleActionResult='CONTINUE',\n        **pick(lifecycle_event, 'LifecycleHookName', 'LifecycleActionToken', 'AutoScalingGroupName'))\n  except Exception as e:\n    # Lifecycle action may have already completed.\n    print(str(e))\n\n\ndef container_instance_arn(cluster, instance_id):\n  \"\"\"Turn an instance ID into a container instance ARN.\"\"\"\n  arns = ecs.list_container_instances(cluster=cluster, filter='ec2InstanceId==' + instance_id)['containerInstanceArns']\n  if not arns:\n    return None\n  return arns[0]\n\ndef container_instance_task_arns(cluster, instance_arn):\n  \"\"\"Fetch tasks for a container instance ARN.\"\"\"\n  arns = ecs.list_tasks(cluster=cluster, containerInstance=instance_arn)['taskArns']\n  return arns\n\ndef has_tasks(cluster, instance_arn, task_arns):\n  \"\"\"Return True if the instance is running tasks for the given cluster.\"\"\"\n  instances = ecs.describe_container_instances(cluster=cluster, containerInstances=[instance_arn])['containerInstances']\n  if not instances:\n    return False\n  instance = instances[0]\n\n  if instance['status'] == 'ACTIVE':\n    # Start draining, then try again later\n    set_container_instance_to_draining(cluster, instance_arn)\n    return True\n\n  task_count = None\n\n  if task_arns:\n    # Fetch details for tasks running on the container instance\n    tasks = ecs.describe_tasks(cluster=cluster, tasks=task_arns)['tasks']\n    if tasks:\n      # Consider any non-stopped tasks as running\n      task_count = sum(task['lastStatus'] != 'STOPPED' for task in tasks) + instance['pendingTasksCount']\n\n  if not task_count:\n    # Fallback to instance task counts if detailed task information is unavailable\n    task_count = instance['runningTasksCount'] + instance['pendingTasksCount']\n\n  print('Instance %s has %s tasks' % (instance_arn, task_count))\n\n  return task_count > 0\n\ndef set_container_instance_to_draining(cluster, instance_arn):\n  ecs.update_container_instances_state(\n      cluster=cluster,\n      containerInstances=[instance_arn], status='DRAINING')\n\n\ndef pick(dct, *keys):\n  \"\"\"Pick a subset of a dict.\"\"\"\n  return {k: v for k, v in dct.items() if k in keys}\n"
        },
        "Environment": {
          "Variables": {
            "CLUSTER": {
              "Ref": "RestApiECSClustertestlisadevClC04148B6"
            }
          }
        },
        "Handler": "index.lambda_handler",
        "Role": {
          "Fn::GetAtt": [
            "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRole63B8BEE5",
            "Arn"
          ]
        },
        "Runtime": "python3.13",
        "Tags": [
          {
            "Key": "Name",
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ],
        "Timeout": 310
      },
      "DependsOn": [
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRoleDefaultPolicy95F8B781",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRole63B8BEE5"
      ]
    },
    "RestApiECSClustertestlisadevASGDrainECSHookFunctionAllowInvokeLisaServeRestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic7E3AEC6718E71340": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RestApiECSClustertestlisadevASGDrainECSHookFunctionB9703624",
            "Arn"
          ]
        },
        "Principal": "sns.amazonaws.com",
        "SourceArn": {
          "Ref": "RestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic4A233E5E"
        }
      }
    },
    "RestApiECSClustertestlisadevASGDrainECSHookFunctionTopicBAEEB019": {
      "Type": "AWS::SNS::Subscription",
      "Properties": {
        "Endpoint": {
          "Fn::GetAtt": [
            "RestApiECSClustertestlisadevASGDrainECSHookFunctionB9703624",
            "Arn"
          ]
        },
        "Protocol": "lambda",
        "TopicArn": {
          "Ref": "RestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic4A233E5E"
        }
      }
    },
    "RestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic4A233E5E": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleEA0CB372": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "autoscaling.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleDefaultPolicyEC0162A6": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic4A233E5E"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleDefaultPolicyEC0162A6",
        "Roles": [
          {
            "Ref": "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleEA0CB372"
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGLifecycleHookDrainHookAC6818CC": {
      "Type": "AWS::AutoScaling::LifecycleHook",
      "Properties": {
        "AutoScalingGroupName": {
          "Ref": "RestApiECSClustertestlisadevASGCAE610D7"
        },
        "DefaultResult": "CONTINUE",
        "HeartbeatTimeout": 300,
        "LifecycleTransition": "autoscaling:EC2_INSTANCE_TERMINATING",
        "NotificationTargetARN": {
          "Ref": "RestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic4A233E5E"
        },
        "RoleARN": {
          "Fn::GetAtt": [
            "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleEA0CB372",
            "Arn"
          ]
        }
      },
      "DependsOn": [
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleDefaultPolicyEC0162A6",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleEA0CB372"
      ]
    },
    "RestApiECSClustertestlisadevASGASGRESTScaleInUpperPolicy4621F1CA": {
      "Type": "AWS::AutoScaling::ScalingPolicy",
      "Properties": {
        "AdjustmentType": "ChangeInCapacity",
        "AutoScalingGroupName": {
          "Ref": "RestApiECSClustertestlisadevASGCAE610D7"
        },
        "MetricAggregationType": "Average",
        "PolicyType": "StepScaling",
        "StepAdjustments": [
          {
            "MetricIntervalLowerBound": 0,
            "MetricIntervalUpperBound": 20,
            "ScalingAdjustment": 2
          },
          {
            "MetricIntervalLowerBound": 20,
            "ScalingAdjustment": 1
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGASGRESTScaleInUpperAlarmCA336253": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmActions": [
          {
            "Ref": "RestApiECSClustertestlisadevASGASGRESTScaleInUpperPolicy4621F1CA"
          }
        ],
        "AlarmDescription": "Upper threshold scaling alarm",
        "ComparisonOperator": "GreaterThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "CapacityProviderName",
            "Value": {
              "Ref": "RestApiECSClustertestlisadevAsgCapacityProviderF18999A7"
            }
          },
          {
            "Name": "ClusterName",
            "Value": {
              "Ref": "RestApiECSClustertestlisadevClC04148B6"
            }
          }
        ],
        "EvaluationPeriods": 5,
        "MetricName": "CapacityProviderReservation",
        "Namespace": "AWS/ECS/CapacityProvider",
        "Period": 60,
        "Statistic": "Average",
        "Tags": [
          {
            "Key": "Name",
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ],
        "Threshold": 40
      }
    },
    "RestApiECSClustertestlisadevASGASGRESTScaleOutLowerPolicy2BDAE944": {
      "Type": "AWS::AutoScaling::ScalingPolicy",
      "Properties": {
        "AdjustmentType": "ChangeInCapacity",
        "AutoScalingGroupName": {
          "Ref": "RestApiECSClustertestlisadevASGCAE610D7"
        },
        "MetricAggregationType": "Average",
        "PolicyType": "StepScaling",
        "StepAdjustments": [
          {
            "MetricIntervalLowerBound": -10,
            "MetricIntervalUpperBound": 0,
            "ScalingAdjustment": 2
          },
          {
            "MetricIntervalUpperBound": -10,
            "ScalingAdjustment": 1
          }
        ]
      }
    },
    "RestApiECSClustertestlisadevASGASGRESTScaleOutLowerAlarm17D7099D": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmActions": [
          {
            "Ref": "RestApiECSClustertestlisadevASGASGRESTScaleOutLowerPolicy2BDAE944"
          }
        ],
        "AlarmDescription": "Lower threshold scaling alarm",
        "ComparisonOperator": "LessThanOrEqualToThreshold",
        "Dimensions": [
          {
            "Name": "CapacityProviderName",
            "Value": {
              "Ref": "RestApiECSClustertestlisadevAsgCapacityProviderF18999A7"
            }
          },
          {
            "Name": "ClusterName",
            "Value": {
              "Ref": "RestApiECSClustertestlisadevClC04148B6"
            }
          }
        ],
        "EvaluationPeriods": 2,
        "MetricName": "CapacityProviderReservation",
        "Namespace": "AWS/ECS/CapacityProvider",
        "Period": 60,
        "Statistic": "Average",
        "Tags": [
          {
            "Key": "Name",
            "Value": "LisaServe/RestApi-ECSCluster/test-lisa-dev-ASG"
          }
        ],
        "Threshold": 90
      }
    },
    "RestApiECSClustertestlisadevAsgCapacityProviderF18999A7": {
      "Type": "AWS::ECS::CapacityProvider",
      "Properties": {
        "AutoScalingGroupProvider": {
          "AutoScalingGroupArn": {
            "Ref": "RestApiECSClustertestlisadevASGCAE610D7"
          },
          "ManagedTerminationProtection": "DISABLED"
        }
      }
    },
    "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/ecs/test-lisa-dev-REST",
        "RetentionInDays": 7
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "RestApiECSClusterdevtestlisalisaRESTLogGroupPolicyResourcePolicy35CF92BF": {
      "Type": "AWS::Logs::ResourcePolicy",
      "Properties": {
        "PolicyDocument": {
          "Fn::Join": [
            "",
            [
              "{\"Statement\":[{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\"],\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"",
              {
                "Fn::Select": [
                  4,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Ref": "SsmParameterValuedevtestlisalisarolesRESTC96584B6F00A464EAD1953AFF4B05118Parameter"
                      }
                    ]
                  }
                ]
              },
              "\"},\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              },
              "\"},{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\"],\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"",
              {
                "Fn::Select": [
                  4,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Ref": "SsmParameterValuedevtestlisalisarolesRESTEXC96584B6F00A464EAD1953AFF4B05118Parameter"
                      }
                    ]
                  }
                ]
              },
              "\"},\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              },
              "\"},{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\"],\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"",
              {
                "Fn::Select": [
                  4,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Ref": "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHC96584B6F00A464EAD1953AFF4B05118Parameter"
                      }
                    ]
                  }
                ]
              },
              "\"},\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              },
              "\"},{\"Action\":[\"logs:CreateLogStream\",\"logs:PutLogEvents\"],\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"",
              {
                "Fn::Select": [
                  4,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Ref": "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHEXC96584B6F00A464EAD1953AFF4B05118Parameter"
                      }
                    ]
                  }
                ]
              },
              "\"},\"Resource\":\"",
              {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              },
              "\"}],\"Version\":\"2012-10-17\"}"
            ]
          ]
        },
        "PolicyName": "LisaServeRestApiECSClusterdevtestlisalisaRESTLogGroupPolicy90D30874"
      }
    },
    "RestApiECSClustertestlisadevRESTALB34F3E71E": {
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false"
          },
          {
            "Key": "idle_timeout.timeout_seconds",
            "Value": "600"
          },
          {
            "Key": "routing.http.drop_invalid_header_fields.enabled",
            "Value": "true"
          }
        ],
        "Name": "test-lisa-dev-rest",
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcRestApiAlbSg469AE4F8GroupIdDB418565"
          }
        ],
        "Subnets": [
          {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCpublicSubnet1SubnetA91B7DBE8B8D2123"
          },
          {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCpublicSubnet2SubnetC9D5B981D613E068"
          }
        ],
        "Type": "application"
      }
    },
    "RestApiECSClustertestlisadevRESTALBRESTApplicationListener1A5BC4B4": {
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
      "Properties": {
        "Certificates": [
          {
            "CertificateArn": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev"
          }
        ],
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTRESTTgtGrpGroup18249DCC"
            },
            "Type": "forward"
          }
        ],
        "LoadBalancerArn": {
          "Ref": "RestApiECSClustertestlisadevRESTALB34F3E71E"
        },
        "Port": 443,
        "Protocol": "HTTPS",
        "SslPolicy": "ELBSecurityPolicy-TLS13-1-2-2021-06"
      }
    },
    "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTRESTTgtGrpGroup18249DCC": {
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "HealthCheckIntervalSeconds": 60,
        "HealthCheckPath": "/health",
        "HealthCheckTimeoutSeconds": 30,
        "HealthyThresholdCount": 2,
        "Name": "test-lisa-rest-rest",
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "false"
          }
        ],
        "TargetType": "instance",
        "UnhealthyThresholdCount": 10,
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTMCPWORKBENCHTgtGrpGroupD99D2C75": {
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "HealthCheckIntervalSeconds": 60,
        "HealthCheckPath": "/health",
        "HealthCheckTimeoutSeconds": 30,
        "HealthyThresholdCount": 2,
        "Name": "test-lisa-rest-mcpworkbench",
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "false"
          }
        ],
        "TargetType": "instance",
        "UnhealthyThresholdCount": 10,
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTMCPWORKBENCHTgtGrpRuleBDFA4026": {
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTMCPWORKBENCHTgtGrpGroupD99D2C75"
            },
            "Type": "forward"
          }
        ],
        "Conditions": [
          {
            "Field": "path-pattern",
            "PathPatternConfig": {
              "Values": [
                "/v2/mcp/*"
              ]
            }
          }
        ],
        "ListenerArn": {
          "Ref": "RestApiECSClustertestlisadevRESTALBRESTApplicationListener1A5BC4B4"
        },
        "Priority": 80
      }
    },
    "RestApiECSClusterRESTTRPolicy68D7DDA5": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":dynamodb:us-iso-east-1:012345678901:table/",
                      {
                        "Ref": "TokenTableNameParameterParameter"
                      }
                    ]
                  ]
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ssm:us-iso-east-1:012345678901:parameter",
                    {
                      "Ref": "LiteLLMDbConnectionInfoStringParameter1408D668"
                    }
                  ]
                ]
              }
            },
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":rds-db:us-iso-east-1:012345678901:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "LiteLLMScalingDB7C8AE765",
                        "DbiResourceId"
                      ]
                    },
                    "/{{resolve:secretsmanager:",
                    {
                      "Ref": "LiteLLMScalingDBSecretAttachmentF62968F9"
                    },
                    ":SecretString:username::}}"
                  ]
                ]
              }
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret"
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "LiteLLMScalingDBSecretAttachmentF62968F9"
              }
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ssm:us-iso-east-1:012345678901:parameter",
                    {
                      "Ref": "RegisteredModelsStringParameter36CC6A6A"
                    }
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RestApiECSClusterRESTTRPolicy68D7DDA5",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolesRESTC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "RestApiECSClusterRESTERPolicyA12E13F6": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ecr:us-iso-east-1:012345678901:repository/cdk-hnb659fds-container-assets-012345678901-us-iso-east-1"
                  ]
                ]
              }
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RestApiECSClusterRESTERPolicyA12E13F6",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolesRESTEXC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "RestApiECSClusterRESTEc2TaskDefinition85643A9A": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "ContainerDefinitions": [
          {
            "Environment": [
              {
                "Name": "LOG_LEVEL",
                "Value": "DEBUG"
              },
              {
                "Name": "AWS_REGION",
                "Value": "us-iso-east-1"
              },
              {
                "Name": "AWS_REGION_NAME",
                "Value": "us-iso-east-1"
              },
              {
                "Name": "THREADS",
                "Value": "2"
              },
              {
                "Name": "USE_AUTH",
                "Value": "true"
              },
              {
                "Name": "AUTHORITY",
                "Value": "test"
              },
              {
                "Name": "CLIENT_ID",
                "Value": "test"
              },
              {
                "Name": "ADMIN_GROUP",
                "Value": ""
              },
              {
                "Name": "USER_GROUP",
                "Value": ""
              },
              {
                "Name": "JWT_GROUPS_PROP",
                "Value": ""
              },
              {
                "Name": "MANAGEMENT_KEY_NAME",
                "Value": {
                  "Ref": "LisaServeResourcesLisaServeResourcesmanagementKeyStringParameterParameterAD609E8A"
                }
              },
              {
                "Name": "TOKEN_TABLE_NAME",
                "Value": {
                  "Ref": "TokenTableNameParameterParameter"
                }
              },
              {
                "Name": "SSL_CERT_DIR",
                "Value": "/etc/pki/tls/certs"
              },
              {
                "Name": "SSL_CERT_FILE",
                "Value": ""
              },
              {
                "Name": "REQUESTS_CA_BUNDLE",
                "Value": ""
              },
              {
                "Name": "AWS_CA_BUNDLE",
                "Value": ""
              },
              {
                "Name": "CURL_CA_BUNDLE",
                "Value": ""
              },
              {
                "Name": "CORS_ORIGINS",
                "Value": {
                  "Fn::Join": [
                    "",
                    [
                      "https://",
                      {
                        "Fn::GetAtt": [
                          "RestApiECSClustertestlisadevRESTALB34F3E71E",
                          "DNSName"
                        ]
                      },
                      ",*"
                    ]
                  ]
                }
              },
              {
                "Name": "LITELLM_KEY",
                "Value": "sk-012345"
              },
              {
                "Name": "OPENAI_API_KEY",
                "Value": "sk-012345"
              },
              {
                "Name": "TIKTOKEN_CACHE_DIR",
                "Value": "/app/TIKTOKEN_CACHE"
              },
              {
                "Name": "LITELLM_DB_INFO_PS_NAME",
                "Value": {
                  "Ref": "LiteLLMDbConnectionInfoStringParameter1408D668"
                }
              },
              {
                "Name": "REGISTERED_MODELS_PS_NAME",
                "Value": {
                  "Ref": "RegisteredModelsStringParameter36CC6A6A"
                }
              },
              {
                "Name": "GUARDRAILS_TABLE_NAME",
                "Value": {
                  "Ref": "GuardrailsTableCEF5B750"
                }
              }
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "exit 0"
              ],
              "Interval": 10,
              "Retries": 3,
              "StartPeriod": 30,
              "Timeout": 5
            },
            "Image": {
              "Fn::Sub": "012345678901.dkr.ecr.us-iso-east-1.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-012345678901-us-iso-east-1:25829b191a333ff5743c12473f9e4315e8c5dff9f3a9489636d5e536f898113d"
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2"
                },
                "awslogs-stream-prefix": "REST",
                "awslogs-region": "us-iso-east-1"
              }
            },
            "Memory": 3904,
            "MemoryReservation": 2048,
            "MountPoints": [
              {
                "ContainerPath": "/etc/pki",
                "ReadOnly": false,
                "SourceVolume": "pki"
              }
            ],
            "Name": "test-lisa-REST",
            "PortMappings": [
              {
                "ContainerPort": 8080,
                "HostPort": 0,
                "Protocol": "tcp"
              }
            ],
            "Privileged": false
          }
        ],
        "ExecutionRoleArn": {
          "Ref": "SsmParameterValuedevtestlisalisarolesRESTEXC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Family": "test-lisa-REST",
        "NetworkMode": "bridge",
        "RequiresCompatibilities": [
          "EC2"
        ],
        "TaskRoleArn": {
          "Ref": "SsmParameterValuedevtestlisalisarolesRESTC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Volumes": [
          {
            "Host": {
              "SourcePath": "/etc/pki"
            },
            "Name": "pki"
          }
        ]
      }
    },
    "RestApiECSClustertestlisaRESTEc2SvcServiceFD91C0F8": {
      "Type": "AWS::ECS::Service",
      "Properties": {
        "CapacityProviderStrategy": [
          {
            "CapacityProvider": {
              "Ref": "RestApiECSClustertestlisadevAsgCapacityProviderF18999A7"
            },
            "Weight": 1
          }
        ],
        "Cluster": {
          "Ref": "RestApiECSClustertestlisadevClC04148B6"
        },
        "DeploymentConfiguration": {
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50
        },
        "EnableECSManagedTags": false,
        "HealthCheckGracePeriodSeconds": 60,
        "LoadBalancers": [
          {
            "ContainerName": "test-lisa-REST",
            "ContainerPort": 8080,
            "TargetGroupArn": {
              "Ref": "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTRESTTgtGrpGroup18249DCC"
            }
          }
        ],
        "SchedulingStrategy": "REPLICA",
        "ServiceName": "REST",
        "TaskDefinition": {
          "Ref": "RestApiECSClusterRESTEc2TaskDefinition85643A9A"
        }
      },
      "DependsOn": [
        "RestApiECSClusterRESTTRPolicy68D7DDA5",
        "RestApiECSClustertestlisadevASGCAE610D7",
        "RestApiECSClustertestlisadevASGASGRESTScaleInUpperAlarmCA336253",
        "RestApiECSClustertestlisadevASGASGRESTScaleInUpperPolicy4621F1CA",
        "RestApiECSClustertestlisadevASGASGRESTScaleOutLowerAlarm17D7099D",
        "RestApiECSClustertestlisadevASGASGRESTScaleOutLowerPolicy2BDAE944",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionAllowInvokeLisaServeRestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic7E3AEC6718E71340",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionB9703624",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRoleDefaultPolicy95F8B781",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRole63B8BEE5",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionTopicBAEEB019",
        "RestApiECSClustertestlisadevASGInstanceProfile5F0036EC",
        "RestApiECSClustertestlisadevASGInstanceRoleDefaultPolicy763E7201",
        "RestApiECSClustertestlisadevASGInstanceRole4F18B1DE",
        "RestApiECSClustertestlisadevASGLaunchConfigD5B6F73C",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookAC6818CC",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleDefaultPolicyEC0162A6",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleEA0CB372",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic4A233E5E",
        "RestApiECSClustertestlisadevRESTALBRESTApplicationListener1A5BC4B4",
        "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTMCPWORKBENCHTgtGrpGroupD99D2C75",
        "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTMCPWORKBENCHTgtGrpRuleBDFA4026",
        "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTRESTTgtGrpGroup18249DCC"
      ]
    },
    "RestApiECSClusterMCPWORKBENCHTRPolicy0E033E1A": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RestApiECSClusterMCPWORKBENCHTRPolicy0E033E1A",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "RestApiECSClusterMCPWORKBENCHERPolicy845EAEEA": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ecr:us-iso-east-1:012345678901:repository/cdk-hnb659fds-container-assets-012345678901-us-iso-east-1"
                  ]
                ]
              }
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RestApiECSClusterMCPWORKBENCHERPolicy845EAEEA",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHEXC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "RestApiECSClusterMCPWORKBENCHEc2TaskDefinition7EAF0AD9": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "ContainerDefinitions": [
          {
            "Environment": [
              {
                "Name": "LOG_LEVEL",
                "Value": "DEBUG"
              },
              {
                "Name": "AWS_REGION",
                "Value": "us-iso-east-1"
              },
              {
                "Name": "AWS_REGION_NAME",
                "Value": "us-iso-east-1"
              },
              {
                "Name": "THREADS",
                "Value": "2"
              },
              {
                "Name": "USE_AUTH",
                "Value": "true"
              },
              {
                "Name": "AUTHORITY",
                "Value": "test"
              },
              {
                "Name": "CLIENT_ID",
                "Value": "test"
              },
              {
                "Name": "ADMIN_GROUP",
                "Value": ""
              },
              {
                "Name": "USER_GROUP",
                "Value": ""
              },
              {
                "Name": "JWT_GROUPS_PROP",
                "Value": ""
              },
              {
                "Name": "MANAGEMENT_KEY_NAME",
                "Value": {
                  "Ref": "LisaServeResourcesLisaServeResourcesmanagementKeyStringParameterParameterAD609E8A"
                }
              },
              {
                "Name": "TOKEN_TABLE_NAME",
                "Value": {
                  "Ref": "TokenTableNameParameterParameter"
                }
              },
              {
                "Name": "SSL_CERT_DIR",
                "Value": "/etc/pki/tls/certs"
              },
              {
                "Name": "SSL_CERT_FILE",
                "Value": ""
              },
              {
                "Name": "REQUESTS_CA_BUNDLE",
                "Value": ""
              },
              {
                "Name": "AWS_CA_BUNDLE",
                "Value": ""
              },
              {
                "Name": "CURL_CA_BUNDLE",
                "Value": ""
              },
              {
                "Name": "CORS_ORIGINS",
                "Value": {
                  "Fn::Join": [
                    "",
                    [
                      "https://",
                      {
                        "Fn::GetAtt": [
                          "RestApiECSClustertestlisadevRESTALB34F3E71E",
                          "DNSName"
                        ]
                      },
                      ",*"
                    ]
                  ]
                }
              },
              {
                "Name": "RCLONE_CONFIG_S3_REGION",
                "Value": "us-iso-east-1"
              },
              {
                "Name": "MCPWORKBENCH_BUCKET",
                "Value": "test-lisa-dev-mcpworkbench-012345678901"
              }
            ],
            "Essential": true,
            "HealthCheck": {
              "Command": [
                "CMD-SHELL",
                "exit 0"
              ],
              "Interval": 10,
              "Retries": 3,
              "StartPeriod": 30,
              "Timeout": 5
            },
            "Image": {
              "Fn::Sub": "012345678901.dkr.ecr.us-iso-east-1.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-012345678901-us-iso-east-1:126c5e7a3d55eb8956aa9a0ab15d3c540075161653874b1152224e6eb27b9305"
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "RestApiECSClusterdevtestlisalisaRESTLogGroup92E80EC2"
                },
                "awslogs-stream-prefix": "MCPWORKBENCH",
                "awslogs-region": "us-iso-east-1"
              }
            },
            "Memory": 3904,
            "MemoryReservation": 1024,
            "MountPoints": [
              {
                "ContainerPath": "/etc/pki",
                "ReadOnly": false,
                "SourceVolume": "pki"
              }
            ],
            "Name": "test-lisa-MCPWORKBENCH",
            "PortMappings": [
              {
                "ContainerPort": 8000,
                "HostPort": 0,
                "Protocol": "tcp"
              }
            ],
            "Privileged": true
          }
        ],
        "ExecutionRoleArn": {
          "Ref": "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHEXC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Family": "test-lisa-MCPWORKBENCH",
        "NetworkMode": "bridge",
        "RequiresCompatibilities": [
          "EC2"
        ],
        "TaskRoleArn": {
          "Ref": "SsmParameterValuedevtestlisalisarolesMCPWORKBENCHC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Volumes": [
          {
            "Host": {
              "SourcePath": "/etc/pki"
            },
            "Name": "pki"
          }
        ]
      }
    },
    "RestApiECSClustertestlisaMCPWORKBENCHEc2SvcService1642D1D0": {
      "Type": "AWS::ECS::Service",
      "Properties": {
        "CapacityProviderStrategy": [
          {
            "CapacityProvider": {
              "Ref": "RestApiECSClustertestlisadevAsgCapacityProviderF18999A7"
            },
            "Weight": 1
          }
        ],
        "Cluster": {
          "Ref": "RestApiECSClustertestlisadevClC04148B6"
        },
        "DeploymentConfiguration": {
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50
        },
        "EnableECSManagedTags": false,
        "HealthCheckGracePeriodSeconds": 60,
        "LoadBalancers": [
          {
            "ContainerName": "test-lisa-MCPWORKBENCH",
            "ContainerPort": 8000,
            "TargetGroupArn": {
              "Ref": "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTMCPWORKBENCHTgtGrpGroupD99D2C75"
            }
          }
        ],
        "SchedulingStrategy": "REPLICA",
        "ServiceName": "MCPWORKBENCH",
        "TaskDefinition": {
          "Ref": "RestApiECSClusterMCPWORKBENCHEc2TaskDefinition7EAF0AD9"
        }
      },
      "DependsOn": [
        "RestApiECSClusterMCPWORKBENCHTRPolicy0E033E1A",
        "RestApiECSClustertestlisadevASGCAE610D7",
        "RestApiECSClustertestlisadevASGASGRESTScaleInUpperAlarmCA336253",
        "RestApiECSClustertestlisadevASGASGRESTScaleInUpperPolicy4621F1CA",
        "RestApiECSClustertestlisadevASGASGRESTScaleOutLowerAlarm17D7099D",
        "RestApiECSClustertestlisadevASGASGRESTScaleOutLowerPolicy2BDAE944",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionAllowInvokeLisaServeRestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic7E3AEC6718E71340",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionB9703624",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRoleDefaultPolicy95F8B781",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionServiceRole63B8BEE5",
        "RestApiECSClustertestlisadevASGDrainECSHookFunctionTopicBAEEB019",
        "RestApiECSClustertestlisadevASGInstanceProfile5F0036EC",
        "RestApiECSClustertestlisadevASGInstanceRoleDefaultPolicy763E7201",
        "RestApiECSClustertestlisadevASGInstanceRole4F18B1DE",
        "RestApiECSClustertestlisadevASGLaunchConfigD5B6F73C",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookAC6818CC",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleDefaultPolicyEC0162A6",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookRoleEA0CB372",
        "RestApiECSClustertestlisadevASGLifecycleHookDrainHookTopic4A233E5E",
        "RestApiECSClustertestlisadevRESTALBRESTApplicationListenerRESTMCPWORKBENCHTgtGrpRuleBDFA4026"
      ]
    },
    "FastApiEndpointF31771C0": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/serve/endpoint",
        "Type": "String",
        "Value": {
          "Fn::Join": [
            "",
            [
              "https://",
              {
                "Fn::GetAtt": [
                  "RestApiECSClustertestlisadevRESTALB34F3E71E",
                  "DNSName"
                ]
              }
            ]
          ]
        }
      }
    },
    "LISALiteLLMScalingSg3CC6544C": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Security group for LiteLLM dynamic model management database",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "10.0.0.128/26",
            "Description": "Allow REST API private subnets to communicate with LISA-LiteLLMScalingSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          },
          {
            "CidrIp": "10.0.0.192/26",
            "Description": "Allow REST API private subnets to communicate with LISA-LiteLLMScalingSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          },
          {
            "CidrIp": "10.0.1.0/26",
            "Description": "Allow REST API private subnets to communicate with LISA-LiteLLMScalingSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          },
          {
            "CidrIp": "10.0.1.64/26",
            "Description": "Allow REST API private subnets to communicate with LISA-LiteLLMScalingSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "LISALiteLLMScalingSgfromLisaNetworkingVpcLambdaSecurityGroupE929D4AD54321CB0EB7E": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "Description": "Allow rotation Lambda to connect to database",
        "FromPort": 5432,
        "GroupId": {
          "Fn::GetAtt": [
            "LISALiteLLMScalingSg3CC6544C",
            "GroupId"
          ]
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
        },
        "ToPort": 5432
      }
    },
    "LiteLLMScalingDBSubnetGroup03777761": {
      "Type": "AWS::RDS::DBSubnetGroup",
      "Properties": {
        "DBSubnetGroupDescription": "Subnet group for LiteLLMScalingDB database",
        "SubnetIds": [
          {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
          },
          {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
          }
        ]
      }
    },
    "LisaServeLiteLLMScalingDBSecret7BF5A8EA3fdaad7efa858a3daf9490cf0a702aeb": {
      "Type": "AWS::SecretsManager::Secret",
      "Properties": {
        "Description": {
          "Fn::Join": [
            "",
            [
              "Generated by the CDK for stack: ",
              {
                "Ref": "AWS::StackName"
              }
            ]
          ]
        },
        "GenerateSecretString": {
          "ExcludeCharacters": " %+~`#$&*()|[]{}:;<>?!'/@\"\\",
          "GenerateStringKey": "password",
          "PasswordLength": 30,
          "SecretStringTemplate": "{\"username\":\"postgres\"}"
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "LiteLLMScalingDBSecretAttachmentF62968F9": {
      "Type": "AWS::SecretsManager::SecretTargetAttachment",
      "Properties": {
        "SecretId": {
          "Ref": "LisaServeLiteLLMScalingDBSecret7BF5A8EA3fdaad7efa858a3daf9490cf0a702aeb"
        },
        "TargetId": {
          "Ref": "LiteLLMScalingDB7C8AE765"
        },
        "TargetType": "AWS::RDS::DBInstance"
      }
    },
    "LiteLLMScalingDBSecretAttachmentDatabasePasswordRotationScheduleC8556257": {
      "Type": "AWS::SecretsManager::RotationSchedule",
      "Properties": {
        "HostedRotationLambda": {
          "ExcludeCharacters": " %+~`#$&*()|[]{}:;<>?!'/@\"\\",
          "RotationLambdaName": "test-lisa-Litellm-Rotation-Function",
          "RotationType": "PostgreSQLSingleUser",
          "VpcSecurityGroupIds": {
            "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
          },
          "VpcSubnetIds": {
            "Fn::Join": [
              "",
              [
                {
                  "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
                },
                ",",
                {
                  "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
                }
              ]
            ]
          }
        },
        "RotationRules": {
          "ScheduleExpression": "rate(30 days)"
        },
        "SecretId": {
          "Ref": "LiteLLMScalingDBSecretAttachmentF62968F9"
        }
      }
    },
    "LiteLLMScalingDBSecretAttachmentPolicyDE12773F": {
      "Type": "AWS::SecretsManager::ResourcePolicy",
      "Properties": {
        "ResourcePolicy": {
          "Statement": [
            {
              "Action": "secretsmanager:DeleteSecret",
              "Effect": "Deny",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":iam::012345678901:root"
                    ]
                  ]
                }
              },
              "Resource": "*"
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret"
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Ref": "SsmParameterValuedevtestlisalisarolesRESTC96584B6F00A464EAD1953AFF4B05118Parameter"
                }
              },
              "Resource": {
                "Ref": "LiteLLMScalingDBSecretAttachmentF62968F9"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "SecretId": {
          "Ref": "LiteLLMScalingDBSecretAttachmentF62968F9"
        }
      }
    },
    "LiteLLMScalingDB7C8AE765": {
      "Type": "AWS::RDS::DBInstance",
      "Properties": {
        "AllocatedStorage": "100",
        "CopyTagsToSnapshot": true,
        "DBInstanceClass": "db.m5.large",
        "DBSubnetGroupName": {
          "Ref": "LiteLLMScalingDBSubnetGroup03777761"
        },
        "EnableIAMDatabaseAuthentication": true,
        "Engine": "postgres",
        "MasterUserPassword": {
          "Fn::Join": [
            "",
            [
              "{{resolve:secretsmanager:",
              {
                "Ref": "LisaServeLiteLLMScalingDBSecret7BF5A8EA3fdaad7efa858a3daf9490cf0a702aeb"
              },
              ":SecretString:password::}}"
            ]
          ]
        },
        "MasterUsername": "postgres",
        "StorageType": "gp2",
        "VPCSecurityGroups": [
          {
            "Fn::GetAtt": [
              "LISALiteLLMScalingSg3CC6544C",
              "GroupId"
            ]
          }
        ]
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "LiteLLMDbConnectionInfoStringParameter1408D668": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/LiteLLMDbConnectionInfo",
        "Type": "String",
        "Value": {
          "Fn::Join": [
            "",
            [
              "{\"username\":\"postgres\",\"dbHost\":\"",
              {
                "Fn::GetAtt": [
                  "LiteLLMScalingDB7C8AE765",
                  "Endpoint.Address"
                ]
              },
              "\",\"dbName\":\"postgres\",\"dbPort\":5432,\"passwordSecretId\":\"",
              {
                "Fn::Join": [
                  "-",
                  [
                    {
                      "Fn::Select": [
                        0,
                        {
                          "Fn::Split": [
                            "-",
                            {
                              "Fn::Select": [
                                6,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Ref": "LisaServeLiteLLMScalingDBSecret7BF5A8EA3fdaad7efa858a3daf9490cf0a702aeb"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "Fn::Select": [
                        1,
                        {
                          "Fn::Split": [
                            "-",
                            {
                              "Fn::Select": [
                                6,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Ref": "LisaServeLiteLLMScalingDBSecret7BF5A8EA3fdaad7efa858a3daf9490cf0a702aeb"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                ]
              },
              "\"}"
            ]
          ]
        }
      }
    },
    "LisaServeRestApiUriStringParameterF8D56C8B": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Description": "URI for LISA Serve API",
        "Name": "/dev/test-lisa/lisa/lisaServeRestApiUri",
        "Type": "String",
        "Value": {
          "Fn::Join": [
            "",
            [
              "https://",
              {
                "Fn::GetAtt": [
                  "RestApiECSClustertestlisadevRESTALB34F3E71E",
                  "DNSName"
                ]
              }
            ]
          ]
        }
      }
    },
    "RegisteredModelsStringParameter36CC6A6A": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Description": "Serialized JSON of registered models data",
        "Name": "/dev/test-lisa/lisa/registeredModels",
        "Type": "String",
        "Value": "[]"
      }
    },
    "ModelInvokePermsACDC92EC": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "bedrock:InvokeModel",
                "bedrock:InvokeModelWithResponseStream",
                "bedrock:ApplyGuardrail"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "sagemaker:InvokeEndpoint",
                "sagemaker:InvokeEndpointWithResponseStream"
              ],
              "Effect": "Allow",
              "Resource": "arn:*:sagemaker:*:*:endpoint/*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "ModelInvokePermsACDC92EC",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolesRESTC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "GuardrailsTablePermsFC141B53": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:Query",
                "dynamodb:GetItem"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:dynamodb:us-iso-east-1:012345678901:table/",
                    {
                      "Ref": "GuardrailsTableCEF5B750"
                    },
                    "/*"
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "GuardrailsTablePermsFC141B53",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolesRESTC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    }
  },
  "Outputs": {
    "RestApiRESTUrl2D81DD2A": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": [
                "RestApiECSClustertestlisadevRESTALB34F3E71E",
                "DNSName"
              ]
            }
          ]
        ]
      }
    },
    "ExportsOutputFnGetAttGuardrailsTableCEF5B750Arn22DC7C03": {
      "Value": {
        "Fn::GetAtt": [
          "GuardrailsTableCEF5B750",
          "Arn"
        ]
      },
      "Export": {
        "Name": "LisaServe:ExportsOutputFnGetAttGuardrailsTableCEF5B750Arn22DC7C03"
      }
    },
    "ExportsOutputRefGuardrailsTableCEF5B750E67E057A": {
      "Value": {
        "Ref": "GuardrailsTableCEF5B750"
      },
      "Export": {
        "Name": "LisaServe:ExportsOutputRefGuardrailsTableCEF5B750E67E057A"
      }
    },
    "ExportsOutputRefRestApiECSClustertestlisadevClC04148B6699D280E": {
      "Value": {
        "Ref": "RestApiECSClustertestlisadevClC04148B6"
      },
      "Export": {
        "Name": "LisaServe:ExportsOutputRefRestApiECSClustertestlisadevClC04148B6699D280E"
      }
    },
    "ExportsOutputFnGetAttRestApiECSClustertestlisaMCPWORKBENCHEc2SvcService1642D1D0Name81C9F72A": {
      "Value": {
        "Fn::GetAtt": [
          "RestApiECSClustertestlisaMCPWORKBENCHEc2SvcService1642D1D0",
          "Name"
        ]
      },
      "Export": {
        "Name": "LisaServe:ExportsOutputFnGetAttRestApiECSClustertestlisaMCPWORKBENCHEc2SvcService1642D1D0Name81C9F72A"
      }
    }
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5"
                  ],
                  {
                    "Ref": "BootstrapVersion"
                  }
                ]
              }
            ]
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
        }
      ]
    }
  }
}
