{
  "Parameters": {
    "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/modelTableName"
    },
    "LisaRestApiUriStringParameterParameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/lisaServeRestApiUri"
    },
    "RegisteredModelsStringParameterParameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/registeredModels"
    },
    "SsmParameterValuedevtestlisalisabucketbucketaccesslogsC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/bucket/bucket-access-logs"
    },
    "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/roles/test-lisa-LisaRagLambdaExecutionRole"
    },
    "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/dev/test-lisa/lisa/layerVersion/common"
    },
    "BootstrapVersion": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
    }
  },
  "Resources": {
    "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "LISARAGtestlisadevFF387D45",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "LISARAGtestlisadevFF387D45",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "LISARAGtestlisadevFF387D45",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              }
            },
            {
              "Action": "s3:DeleteObject*",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "LISARAGtestlisadevFF387D45",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagRepositoryConfigTable6FA366CB",
                    "Arn"
                  ]
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "IngestionStackConstructIngestionJobTable8103D8C1",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "IngestionStackConstructIngestionJobTable8103D8C1",
                          "Arn"
                        ]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "batch:SubmitJob",
              "Effect": "Allow",
              "Resource": [
                {
                  "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                },
                {
                  "Fn::GetAtt": [
                    "IngestionStackConstructIngestionJobQueueCECF0CDA",
                    "JobQueueArn"
                  ]
                }
              ]
            },
            {
              "Action": "batch:SubmitJob",
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ssm:us-iso-east-1:012345678901:parameter/dev/test-lisa/lisa/registeredModels"
                  ]
                ]
              }
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ssm:us-iso-east-1:012345678901:parameter/dev/test-lisa/lisa/lisaServeRestApiUri"
                  ]
                ]
              }
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "testlisaRagDocumentTable5A134785",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "testlisaRagDocumentTable5A134785",
                          "Arn"
                        ]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "testlisaRagSubDocumentTable76E4AE52",
                    "Arn"
                  ]
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "LISARAGtestlisadevFF387D45": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "CorsConfiguration": {
          "CorsRules": [
            {
              "AllowedHeaders": [
                "*"
              ],
              "AllowedMethods": [
                "GET",
                "POST"
              ],
              "AllowedOrigins": [
                "*"
              ],
              "ExposedHeaders": [
                "Access-Control-Allow-Origin"
              ]
            }
          ]
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Fn::Select": [
              0,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisabucketbucketaccesslogsC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          },
          "LogFilePrefix": "logs/rag-bucket/"
        },
        "Tags": [
          {
            "Key": "aws-cdk:auto-delete-objects",
            "Value": "true"
          }
        ]
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "LISARAGtestlisadevPolicyF173721C": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "LISARAGtestlisadevFF387D45"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false"
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "LISARAGtestlisadevFF387D45",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "LISARAGtestlisadevFF387D45",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:PutBucketPolicy",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*"
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
                    "Arn"
                  ]
                }
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "LISARAGtestlisadevFF387D45",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "LISARAGtestlisadevFF387D45",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
                }
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "LISARAGtestlisadevFF387D45",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "LISARAGtestlisadevFF387D45",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
                }
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "LISARAGtestlisadevFF387D45",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              }
            },
            {
              "Action": "s3:DeleteObject*",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
                }
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "LISARAGtestlisadevFF387D45",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "LISARAGtestlisadevAutoDeleteObjectsCustomResourceE4AE69D8": {
      "Type": "Custom::S3AutoDeleteObjects",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F",
            "Arn"
          ]
        },
        "BucketName": {
          "Ref": "LISARAGtestlisadevFF387D45"
        }
      },
      "DependsOn": [
        "LISARAGtestlisadevPolicyF173721C"
      ],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ]
        },
        "ManagedPolicyArns": [
          {
            "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
          }
        ]
      }
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "faa95a81ae7d7373f3e1f242268f904eb748d8d0fdd306e8a6fe515a1905a7d6.zip"
        },
        "Timeout": 900,
        "MemorySize": 128,
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
            "Arn"
          ]
        },
        "Runtime": "nodejs22.x",
        "Description": {
          "Fn::Join": [
            "",
            [
              "Lambda function for auto-deleting objects in ",
              {
                "Ref": "LISARAGtestlisadevFF387D45"
              },
              " S3 bucket."
            ]
          ]
        }
      },
      "DependsOn": [
        "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092"
      ]
    },
    "testlisaRagDocumentTable5A134785": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "pk",
            "AttributeType": "S"
          },
          {
            "AttributeName": "document_id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "repository_id",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "document_index",
            "KeySchema": [
              {
                "AttributeName": "document_id",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "repository_index",
            "KeySchema": [
              {
                "AttributeName": "repository_id",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "pk",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "document_id",
            "KeyType": "RANGE"
          }
        ],
        "SSESpecification": {
          "SSEEnabled": true
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "testlisaRagSubDocumentTable76E4AE52": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "document_id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "sk",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "document_id",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "sk",
            "KeyType": "RANGE"
          }
        ],
        "SSESpecification": {
          "SSEEnabled": true
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "RagLayerF72F34A6": {
      "Type": "AWS::Lambda::LayerVersion",
      "Properties": {
        "CompatibleRuntimes": [
          "python3.11"
        ],
        "Content": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "bdb843ae57a1a6f5714c8910570451c0e9f842588047ce7f612cb88c83ff52ed.zip"
        },
        "Description": "Lambda dependencies for RAG API"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "testlisadevRagLayerECB05657": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/layerVersion/rag",
        "Type": "String",
        "Value": {
          "Ref": "RagLayerF72F34A6"
        }
      }
    },
    "LISAOpenSearchSg9A9088E8": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Security group for RAG OpenSearch domain",
        "GroupName": "test-lisa-OpenSearch-SG",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "10.0.0.128/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80
          },
          {
            "CidrIp": "10.0.0.192/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80
          },
          {
            "CidrIp": "10.0.1.0/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80
          },
          {
            "CidrIp": "10.0.1.64/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80
          },
          {
            "CidrIp": "10.0.0.128/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443
          },
          {
            "CidrIp": "10.0.0.192/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443
          },
          {
            "CidrIp": "10.0.1.0/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443
          },
          {
            "CidrIp": "10.0.1.64/26",
            "Description": "Allow REST API private subnets to communicate with LISA-OpenSearchSg",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "openSearchSecurityGroupIdStringParameter5B897A08": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Description": "Security Group ID for OpenSearch domain",
        "Name": "/dev/test-lisa/lisa/openSearchSecurityGroupId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LISAOpenSearchSg9A9088E8",
            "GroupId"
          ]
        }
      }
    },
    "LISAPGVectorSgA2425084": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Security group for RAG PGVector database",
        "GroupName": "LISA-PGVector-SG",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "10.0.0.128/26",
            "Description": "Allow REST API private subnets to communicate with LISA-PGVectorSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          },
          {
            "CidrIp": "10.0.0.192/26",
            "Description": "Allow REST API private subnets to communicate with LISA-PGVectorSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          },
          {
            "CidrIp": "10.0.1.0/26",
            "Description": "Allow REST API private subnets to communicate with LISA-PGVectorSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          },
          {
            "CidrIp": "10.0.1.64/26",
            "Description": "Allow REST API private subnets to communicate with LISA-PGVectorSg",
            "FromPort": 5432,
            "IpProtocol": "tcp",
            "ToPort": 5432
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "pgvectorSecurityGroupIdStringParameterCCE24FA5": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Description": "Security Group ID for PGVector database",
        "Name": "/dev/test-lisa/lisa/pgvectorSecurityGroupId",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "LISAPGVectorSgA2425084",
            "GroupId"
          ]
        }
      }
    },
    "RagRepositoryConfigTable6FA366CB": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "repositoryId",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "repositoryId",
            "KeyType": "HASH"
          }
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true
        },
        "SSESpecification": {
          "SSEEnabled": true
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES"
        },
        "TableName": "test-lisa-dev-rag-repository-config",
        "TimeToLiveSpecification": {
          "AttributeName": "ttl",
          "Enabled": true
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "IngestionStackConstructIngestionJobTable8103D8C1": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "document_id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "repository_id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "created_date",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "documentId",
            "KeySchema": [
              {
                "AttributeName": "document_id",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "repository_id-created_date-index",
            "KeySchema": [
              {
                "AttributeName": "repository_id",
                "KeyType": "HASH"
              },
              {
                "AttributeName": "created_date",
                "KeyType": "RANGE"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "id",
            "KeyType": "HASH"
          }
        ],
        "TableName": "test-lisa-dev-ingestion-job"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "IngestionStackConstructIngestionJobLogGroupED038CC2": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "RetentionInDays": 7
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "IngestionStackConstructIngestionJobFargateEnvSecurityGroup2A62D5C0": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "LisaRAG/IngestionStackConstruct/IngestionJobFargateEnv/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "IngestionStackConstructIngestionJobFargateEnvD92342F8": {
      "Type": "AWS::Batch::ComputeEnvironment",
      "Properties": {
        "ComputeEnvironmentName": "test-lisa-dev-ingestion-job-05f84580be3a",
        "ComputeResources": {
          "MaxvCpus": 128,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "IngestionStackConstructIngestionJobFargateEnvSecurityGroup2A62D5C0",
                "GroupId"
              ]
            }
          ],
          "Subnets": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ],
          "Type": "FARGATE"
        },
        "ReplaceComputeEnvironment": false,
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {}
      }
    },
    "IngestionStackConstructIngestionJobQueueCECF0CDA": {
      "Type": "AWS::Batch::JobQueue",
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "IngestionStackConstructIngestionJobFargateEnvD92342F8",
                "ComputeEnvironmentArn"
              ]
            },
            "Order": 1
          }
        ],
        "JobQueueName": "test-lisa-dev-ingestion-job-05f84580be3a",
        "Priority": 1,
        "State": "ENABLED"
      }
    },
    "IngestionStackConstructIngestionJobContainerExecutionRole669198BD": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "IngestionStackConstructIngestionJobContainerExecutionRoleDefaultPolicyB28C1B30": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "IngestionStackConstructIngestionJobLogGroupED038CC2",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ecr:us-iso-east-1:012345678901:repository/cdk-hnb659fds-container-assets-012345678901-us-iso-east-1"
                  ]
                ]
              }
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "IngestionStackConstructIngestionJobContainerExecutionRoleDefaultPolicyB28C1B30",
        "Roles": [
          {
            "Ref": "IngestionStackConstructIngestionJobContainerExecutionRole669198BD"
          }
        ]
      }
    },
    "IngestionStackConstructIngestionJobDefinition529FE179": {
      "Type": "AWS::Batch::JobDefinition",
      "Properties": {
        "ContainerProperties": {
          "Command": [
            "-m",
            "repository.pipeline_ingestion",
            "Ref::ACTION",
            "Ref::DOCUMENT_ID"
          ],
          "Environment": [
            {
              "Name": "ADMIN_GROUP",
              "Value": ""
            },
            {
              "Name": "BUCKET_NAME",
              "Value": {
                "Ref": "LISARAGtestlisadevFF387D45"
              }
            },
            {
              "Name": "CHUNK_OVERLAP",
              "Value": "51"
            },
            {
              "Name": "CHUNK_SIZE",
              "Value": "512"
            },
            {
              "Name": "LISA_API_URL_PS_NAME",
              "Value": "/dev/test-lisa/lisa/lisaServeRestApiUri"
            },
            {
              "Name": "LOG_LEVEL",
              "Value": "DEBUG"
            },
            {
              "Name": "MANAGEMENT_KEY_SECRET_NAME_PS",
              "Value": "/dev/test-lisa/lisa/managementKeySecretName"
            },
            {
              "Name": "MODEL_TABLE_NAME",
              "Value": {
                "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
              }
            },
            {
              "Name": "RAG_DOCUMENT_TABLE",
              "Value": {
                "Ref": "testlisaRagDocumentTable5A134785"
              }
            },
            {
              "Name": "RAG_SUB_DOCUMENT_TABLE",
              "Value": {
                "Ref": "testlisaRagSubDocumentTable76E4AE52"
              }
            },
            {
              "Name": "REGISTERED_MODELS_PS_NAME",
              "Value": "/dev/test-lisa/lisa/registeredModels"
            },
            {
              "Name": "REGISTERED_REPOSITORIES_PS_PREFIX",
              "Value": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/"
            },
            {
              "Name": "REGISTERED_REPOSITORIES_PS",
              "Value": "/dev/test-lisa/lisa/registeredRepositories"
            },
            {
              "Name": "REST_API_VERSION",
              "Value": "v2"
            },
            {
              "Name": "TIKTOKEN_CACHE_DIR",
              "Value": "/opt/python/TIKTOKEN_CACHE"
            },
            {
              "Name": "RESTAPI_SSL_CERT_ARN",
              "Value": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev"
            },
            {
              "Name": "LISA_RAG_VECTOR_STORE_TABLE",
              "Value": {
                "Ref": "RagRepositoryConfigTable6FA366CB"
              }
            },
            {
              "Name": "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER",
              "Value": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create"
            },
            {
              "Name": "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER",
              "Value": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete"
            },
            {
              "Name": "LISA_INGESTION_JOB_TABLE_NAME",
              "Value": {
                "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
              }
            },
            {
              "Name": "LISA_INGESTION_JOB_QUEUE_NAME",
              "Value": {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                  "JobQueueArn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            }
          ],
          "ExecutionRoleArn": {
            "Fn::GetAtt": [
              "IngestionStackConstructIngestionJobContainerExecutionRole669198BD",
              "Arn"
            ]
          },
          "FargatePlatformConfiguration": {},
          "Image": {
            "Fn::Sub": "012345678901.dkr.ecr.us-iso-east-1.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-012345678901-us-iso-east-1:cdf42103df5398f35f92245df3575c31893f829ef0f71d4ea87c5d37103ad3e5"
          },
          "JobRoleArn": {
            "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
          },
          "LogConfiguration": {
            "LogDriver": "awslogs",
            "Options": {
              "awslogs-group": {
                "Ref": "IngestionStackConstructIngestionJobLogGroupED038CC2"
              },
              "awslogs-stream-prefix": "batch-job",
              "awslogs-region": "us-iso-east-1"
            }
          },
          "NetworkConfiguration": {
            "AssignPublicIp": "DISABLED"
          },
          "ReadonlyRootFilesystem": false,
          "ResourceRequirements": [
            {
              "Type": "MEMORY",
              "Value": "4096"
            },
            {
              "Type": "VCPU",
              "Value": "2"
            }
          ],
          "RuntimePlatform": {}
        },
        "JobDefinitionName": "test-lisa-dev-ingestion-job-05f84580be3a",
        "PlatformCapabilities": [
          "FARGATE"
        ],
        "RetryStrategy": {
          "Attempts": 1
        },
        "Timeout": {
          "AttemptDurationSeconds": 14400
        },
        "Type": "container"
      }
    },
    "IngestionStackConstructhandlePipelineIngestScheduleSecurityGroup0CE86B5C": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function LisaRAGIngestionStackConstructhandlePipelineIngestScheduleCD7DF5A4",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "IngestionStackConstructhandlePipelineIngestSchedule4418AB88": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "test-lisa-dev-ingestion-ingest-schedule-05f84580be3a",
        "Handler": "repository.pipeline_ingest_documents.handle_pipline_ingest_schedule",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 256,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 60,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "IngestionStackConstructhandlePipelineIngestScheduleSecurityGroup0CE86B5C",
                "GroupId"
              ]
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "IngestionStackConstructhandlePipelineIngestScheduleAllowEventBridgeInvoke333FA84B": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "IngestionStackConstructhandlePipelineIngestSchedule4418AB88",
            "Arn"
          ]
        },
        "Principal": "events.amazonaws.com"
      }
    },
    "IngestionStackConstructIngestionJobScheduleLambdaArn95353A02": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/ingestion/ingest/schedule",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "IngestionStackConstructhandlePipelineIngestSchedule4418AB88",
            "Arn"
          ]
        }
      }
    },
    "IngestionStackConstructhandlePipelineIngestEventSecurityGroup0E4AA865": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function LisaRAGIngestionStackConstructhandlePipelineIngestEventE78BDF9C",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "IngestionStackConstructhandlePipelineIngestEvent30BCC23B": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "test-lisa-dev-ingestion-ingest-event-05f84580be3a",
        "Handler": "repository.pipeline_ingest_documents.handle_pipeline_ingest_event",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 256,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 60,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "IngestionStackConstructhandlePipelineIngestEventSecurityGroup0E4AA865",
                "GroupId"
              ]
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "IngestionStackConstructhandlePipelineIngestEventAllowEventBridgeInvoke378D27AA": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "IngestionStackConstructhandlePipelineIngestEvent30BCC23B",
            "Arn"
          ]
        },
        "Principal": "events.amazonaws.com"
      }
    },
    "IngestionStackConstructIngestionJobEventLambdaArn86A07D4D": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/ingestion/ingest/event",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "IngestionStackConstructhandlePipelineIngestEvent30BCC23B",
            "Arn"
          ]
        }
      }
    },
    "IngestionStackConstructhandlePipelineDeleteEventSecurityGroup94D216B4": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function LisaRAGIngestionStackConstructhandlePipelineDeleteEventC539F9F0",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "IngestionStackConstructhandlePipelineDeleteEventC723B80D": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "test-lisa-dev-ingestion-delete-event-05f84580be3a",
        "Handler": "repository.pipeline_ingest_documents.handle_pipeline_delete_event",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 256,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 60,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "IngestionStackConstructhandlePipelineDeleteEventSecurityGroup94D216B4",
                "GroupId"
              ]
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "IngestionStackConstructhandlePipelineDeleteEventAllowEventBridgeInvoke6FF761E2": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "IngestionStackConstructhandlePipelineDeleteEventC723B80D",
            "Arn"
          ]
        },
        "Principal": "events.amazonaws.com"
      }
    },
    "IngestionStackConstructDeletionJobEventLambdaArnD1BD729F": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/ingestion/delete/event",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "IngestionStackConstructhandlePipelineDeleteEventC723B80D",
            "Arn"
          ]
        }
      }
    },
    "VectorStoreCreatorStackdevtestlisalisarolestestlisaVectorStoreCreatorRole34491B98": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/AWSCloudFormationFullAccess"
              ]
            ]
          }
        ]
      }
    },
    "VectorStoreCreatorStackdevtestlisalisarolestestlisaVectorStoreCreatorRoleDefaultPolicy2CAE92FD": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:*",
                "ec2:*",
                "rds:*",
                "opensearch:*",
                "ssm:*"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:CreateServiceLinkedRole",
              "Condition": {
                "StringEquals": {
                  "iam:AWSServiceName": [
                    "opensearchservice.amazonaws.com",
                    "rds.amazonaws.com"
                  ]
                }
              },
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "iam:CreateRole",
                "iam:DeleteRole",
                "iam:AttachRolePolicy",
                "iam:DetachRolePolicy",
                "iam:PutRolePolicy",
                "iam:DeleteRolePolicy",
                "iam:TagRole",
                "iam:UntagRole",
                "iam:GetRole",
                "iam:GetRolePolicy",
                "iam:ListRolePolicies",
                "iam:ListAttachedRolePolicies",
                "iam:ListRoleTags",
                "iam:UpdateAssumeRolePolicy",
                "iam:ListRoles"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "iam:AssumeRole",
              "Effect": "Allow",
              "Resource": [
                "arn:aws:iam::012345678901:role/cdk-*-deploy-role-012345678901-us-iso-east-1",
                "arn:aws:iam::012345678901:role/cdk-hnb659fds-deploy-role-012345678901-us-iso-east-1"
              ]
            },
            {
              "Action": "iam:PassRole",
              "Condition": {
                "StringEquals": {
                  "iam:PassedToService": [
                    "cloudformation.amazonaws.com",
                    "lambda.amazonaws.com",
                    "events.amazonaws.com"
                  ]
                }
              },
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "VectorStoreCreatorStackdevtestlisalisarolestestlisaVectorStoreCreatorRoleDefaultPolicy2CAE92FD",
        "Roles": [
          {
            "Ref": "VectorStoreCreatorStackdevtestlisalisarolestestlisaVectorStoreCreatorRole34491B98"
          }
        ]
      }
    },
    "VectorStoreCreatorStacktestlisadevStateMachineRoleC93BE6D8": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "VectorStoreCreatorStacktestlisadevStateMachineRoleDefaultPolicyDF7CE587": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagRepositoryConfigTable6FA366CB",
                    "Arn"
                  ]
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "VectorStoreCreatorStacktestlisadevvectorstoredeployerFnB20C2A9E",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "VectorStoreCreatorStacktestlisadevvectorstoredeployerFnB20C2A9E",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "VectorStoreCreatorStacktestlisadevvectorstoredeployerFnB20C2A9E",
                  "Arn"
                ]
              }
            },
            {
              "Action": [
                "cloudformation:DescribeStacks",
                "cloudformation:DeleteStack"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:GetItem",
                "dynamodb:DeleteItem"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagRepositoryConfigTable6FA366CB",
                  "Arn"
                ]
              }
            },
            {
              "Action": "dynamodb:PutItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":dynamodb:us-iso-east-1:012345678901:table/",
                    {
                      "Fn::Select": [
                        1,
                        {
                          "Fn::Split": [
                            "/",
                            {
                              "Fn::Select": [
                                5,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Fn::GetAtt": [
                                        "RagRepositoryConfigTable6FA366CB",
                                        "Arn"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                ]
              }
            },
            {
              "Action": "cloudformation:describeStacks",
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":dynamodb:us-iso-east-1:012345678901:table/",
                    {
                      "Fn::Select": [
                        1,
                        {
                          "Fn::Split": [
                            "/",
                            {
                              "Fn::Select": [
                                5,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Fn::GetAtt": [
                                        "RagRepositoryConfigTable6FA366CB",
                                        "Arn"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                ]
              }
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "VectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFuncB129B35B",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "VectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFuncB129B35B",
                          "Arn"
                        ]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "dynamodb:GetItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":dynamodb:us-iso-east-1:012345678901:table/",
                    {
                      "Fn::Select": [
                        1,
                        {
                          "Fn::Split": [
                            "/",
                            {
                              "Fn::Select": [
                                5,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Fn::GetAtt": [
                                        "RagRepositoryConfigTable6FA366CB",
                                        "Arn"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                ]
              }
            },
            {
              "Action": "cloudformation:deleteStack",
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": "dynamodb:DeleteItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":dynamodb:us-iso-east-1:012345678901:table/",
                    {
                      "Fn::Select": [
                        1,
                        {
                          "Fn::Split": [
                            "/",
                            {
                              "Fn::Select": [
                                5,
                                {
                                  "Fn::Split": [
                                    ":",
                                    {
                                      "Fn::GetAtt": [
                                        "RagRepositoryConfigTable6FA366CB",
                                        "Arn"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "VectorStoreCreatorStacktestlisadevStateMachineRoleDefaultPolicyDF7CE587",
        "Roles": [
          {
            "Ref": "VectorStoreCreatorStacktestlisadevStateMachineRoleC93BE6D8"
          }
        ]
      }
    },
    "VectorStoreCreatorStacktestlisadevvectorstoredeployerFnB20C2A9E": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "a48910598306b50a312adfedfdd77008fb84c9e18795e4a8d52a7c012e216490.zip"
        },
        "Environment": {
          "Variables": {
            "LISA_CONFIG": {
              "Fn::Join": [
                "",
                [
                  "{\"accountNumber\":\"012345678901\",\"appName\":\"lisa\",\"deploymentName\":\"test-lisa\",\"deploymentStage\":\"dev\",\"deploymentPrefix\":\"/dev/test-lisa/lisa\",\"partition\":\"aws\",\"region\":\"us-iso-east-1\",\"removalPolicy\":\"destroy\",\"profile\":\"\",\"vpcId\":\"",
                  {
                    "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
                  },
                  "\"}"
                ]
              ]
            },
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "RagRepositoryConfigTable6FA366CB",
                                "Arn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "EphemeralStorage": {
          "Size": 2048
        },
        "FunctionName": "test-lisa-dev-vector_store_deployer-Fn",
        "Handler": "index.handler",
        "MemorySize": 1024,
        "Role": {
          "Fn::GetAtt": [
            "VectorStoreCreatorStackdevtestlisalisarolestestlisaVectorStoreCreatorRole34491B98",
            "Arn"
          ]
        },
        "Runtime": "nodejs18.x",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "VectorStoreCreatorStackdevtestlisalisarolestestlisaVectorStoreCreatorRoleDefaultPolicy2CAE92FD",
        "VectorStoreCreatorStackdevtestlisalisarolestestlisaVectorStoreCreatorRole34491B98"
      ]
    },
    "VectorStoreCreatorStackCreateVectorStoreStateMachineCreateStoreStateMachine6CB371E8": {
      "Type": "AWS::StepFunctions::StateMachine",
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{\"StartAt\":\"CreateVectorStoreEntry\",\"States\":{\"CreateVectorStoreEntry\":{\"Next\":\"CreateVectorStoreInfraChoice\",\"Type\":\"Task\",\"ResultPath\":\"$.dynamoResult\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:putItem\",\"Parameters\":{\"Item\":{\"repositoryId\":{\"S.$\":\"$.body.ragConfig.repositoryId\"},\"status\":{\"S\":\"CREATE_IN_PROGRESS\"},\"config\":{\"M.$\":\"$.config\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\"}},\"CreateVectorStoreInfraChoice\":{\"Type\":\"Choice\",\"Choices\":[{\"And\":[{\"Variable\":\"$.body.ragConfig.type\",\"StringEquals\":\"bedrock_knowledge_base\"},{\"Variable\":\"$.body.ragConfig.pipelines[0]\",\"IsPresent\":false}],\"Next\":\"UpdateBedrockKBSuccess\"}],\"Default\":\"DeployVectorStore\"},\"DeployVectorStore\":{\"Next\":\"DescribeStack\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"Next\":\"UpdateFailureStatus\"}],\"Type\":\"Task\",\"ResultPath\":\"$.deployResult\",\"ResultSelector\":{\"stackName.$\":\"$.Payload.stackName\"},\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",
              {
                "Fn::GetAtt": [
                  "VectorStoreCreatorStacktestlisadevvectorstoredeployerFnB20C2A9E",
                  "Arn"
                ]
              },
              "\",\"Payload\":{\"ragConfig.$\":\"$.body.ragConfig\"}}},\"DescribeStack\":{\"Next\":\"DeploymentComplete?\",\"Type\":\"Task\",\"ResultPath\":\"$.deployResult\",\"ResultSelector\":{\"stackName.$\":\"$.Stacks[0].StackName\",\"status.$\":\"$.Stacks[0].StackStatus\"},\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::aws-sdk:cloudformation:describeStacks\",\"Parameters\":{\"StackName.$\":\"$.deployResult.stackName\"}},\"Wait\":{\"Type\":\"Wait\",\"Seconds\":30,\"Next\":\"DescribeStack\"},\"DeploymentComplete?\":{\"Type\":\"Choice\",\"Choices\":[{\"And\":[{\"Variable\":\"$.deployResult.status\",\"IsPresent\":true},{\"Or\":[{\"Variable\":\"$.deployResult.status\",\"StringEquals\":\"CREATE_IN_PROGRESS\"},{\"Variable\":\"$.deployResult.status\",\"StringEquals\":\"UPDATE_IN_PROGRESS\"},{\"Variable\":\"$.deployResult.status\",\"StringEquals\":\"UPDATE_COMPLETE_CLEANUP_IN_PROGRESS\"}]}],\"Next\":\"Wait\"},{\"And\":[{\"Variable\":\"$.deployResult.status\",\"IsPresent\":true},{\"Or\":[{\"Variable\":\"$.deployResult.status\",\"StringEquals\":\"CREATE_COMPLETE\"},{\"Variable\":\"$.deployResult.status\",\"StringEquals\":\"UPDATE_COMPLETE\"}]}],\"Next\":\"UpdateSuccessStatus\"}],\"Default\":\"UpdateFailureStatus\"},\"UpdateFailureStatus\":{\"End\":true,\"Type\":\"Task\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"repositoryId\":{\"S.$\":\"$.body.ragConfig.repositoryId\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\",\"ExpressionAttributeNames\":{\"#status\":\"status\",\"#stackName\":\"stackName\"},\"ExpressionAttributeValues\":{\":status\":{\"S\":\"CREATE_FAILED\"},\":stackName\":{\"S.$\":\"$.deployResult.stackName\"}},\"UpdateExpression\":\"SET #status = :status, #stackName = :stackName\"}},\"UpdateSuccessStatus\":{\"End\":true,\"Type\":\"Task\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"repositoryId\":{\"S.$\":\"$.body.ragConfig.repositoryId\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\",\"ExpressionAttributeNames\":{\"#status\":\"status\",\"#stackName\":\"stackName\"},\"ExpressionAttributeValues\":{\":status\":{\"S\":\"CREATE_COMPLETE\"},\":stackName\":{\"S.$\":\"$.deployResult.stackName\"}},\"UpdateExpression\":\"SET #status = :status, #stackName = :stackName\"}},\"UpdateBedrockKBSuccess\":{\"End\":true,\"Type\":\"Task\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"repositoryId\":{\"S.$\":\"$.body.ragConfig.repositoryId\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\",\"ExpressionAttributeNames\":{\"#status\":\"status\"},\"ExpressionAttributeValues\":{\":status\":{\"S\":\"CREATE_COMPLETE\"}},\"UpdateExpression\":\"SET #status = :status\"}}}}"
            ]
          ]
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "VectorStoreCreatorStacktestlisadevStateMachineRoleC93BE6D8",
            "Arn"
          ]
        },
        "StateMachineType": "STANDARD"
      },
      "DependsOn": [
        "VectorStoreCreatorStacktestlisadevStateMachineRoleDefaultPolicyDF7CE587",
        "VectorStoreCreatorStacktestlisadevStateMachineRoleC93BE6D8"
      ],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "VectorStoreCreatorStackCreateVectorStoreStateMachineCreateStoreStateMachineArnBF39408A": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
        "Type": "String",
        "Value": {
          "Ref": "VectorStoreCreatorStackCreateVectorStoreStateMachineCreateStoreStateMachine6CB371E8"
        }
      }
    },
    "VectorStoreCreatorStackCreateVectorStoreStateMachineStateMachineExecutePolicyC29C6010": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "VectorStoreCreatorStackCreateVectorStoreStateMachineCreateStoreStateMachine6CB371E8"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RagVectorStoreStateMacineCreateExec",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "VectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFuncSecurityGroup12118FB8": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function LisaRAGVectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFunc9BCC544B",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPC8B8C4E4BB8544CDA"
        }
      }
    },
    "VectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFuncB129B35B": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "Handler": "repository.state_machine.cleanup_repo_docs.lambda_handler",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 2048,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "VectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFuncSecurityGroup12118FB8",
                "GroupId"
              ]
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      }
    },
    "VectorStoreCreatorStackDeleteStoreStateMachine70A7FD86": {
      "Type": "AWS::StepFunctions::StateMachine",
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{\"StartAt\":\"UpdateDeleteStatus\",\"States\":{\"UpdateDeleteStatus\":{\"Next\":\"ShouldSkipCleanup\",\"Type\":\"Task\",\"ResultPath\":\"$.updateDynamoDbResult\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"repositoryId\":{\"S.$\":\"$.repositoryId\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\",\"ExpressionAttributeNames\":{\"#status\":\"status\"},\"ExpressionAttributeValues\":{\":status\":{\"S\":\"DELETE_IN_PROGRESS\"}},\"UpdateExpression\":\"SET #status = :status\"}},\"ShouldSkipCleanup\":{\"Type\":\"Choice\",\"Choices\":[{\"And\":[{\"Variable\":\"$.skipDocumentRemoval\",\"IsPresent\":true},{\"Variable\":\"$.skipDocumentRemoval\",\"BooleanEquals\":true}],\"Next\":\"BedrockKnowledgeBase\"}],\"Default\":\"CleanupRepositoryDocs\"},\"CleanupRepositoryDocs\":{\"Next\":\"HasMoreDocs\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"OutputPath\":\"$.Payload\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",
              {
                "Fn::GetAtt": [
                  "VectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFuncB129B35B",
                  "Arn"
                ]
              },
              "\",\"Payload\":{\"repositoryId.$\":\"$.repositoryId\",\"stackName.$\":\"$.stackName\"}}},\"HasMoreDocs\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.lastEvaluated\",\"IsNull\":false,\"Next\":\"CleanupRepositoryDocsRetry\"}],\"Default\":\"GetRepoFromDdb\"},\"GetRepoFromDdb\":{\"Next\":\"BedrockKnowledgeBase\",\"Type\":\"Task\",\"ResultPath\":\"$.ddbResult\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:getItem\",\"Parameters\":{\"Key\":{\"repositoryId\":{\"S.$\":\"$.repositoryId\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\",\"ConsistentRead\":false}},\"BedrockKnowledgeBase\":{\"Type\":\"Choice\",\"Choices\":[{\"And\":[{\"Variable\":\"$.ddbResult.Item.config.M.type.S\",\"StringEquals\":\"bedrock_knowledge_base\"},{\"Variable\":\"$.stackName\",\"IsNull\":true}],\"Next\":\"DeleteDynamoDbEntry\"}],\"Default\":\"DeleteStack\"},\"DeleteStack\":{\"Next\":\"Check Stack Status\",\"Type\":\"Task\",\"ResultPath\":\"$.deleteResult\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::aws-sdk:cloudformation:deleteStack\",\"Parameters\":{\"StackName.$\":\"$.stackName\"}},\"Check Stack Status\":{\"Next\":\"DeletionSuccessful?\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"DeleteDynamoDbEntry\"}],\"Type\":\"Task\",\"ResultPath\":\"$.checkResult\",\"ResultSelector\":{\"stackName.$\":\"$.Stacks[0].StackName\",\"status.$\":\"$.Stacks[0].StackStatus\"},\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::aws-sdk:cloudformation:describeStacks\",\"Parameters\":{\"StackName.$\":\"$.stackName\"}},\"Wait\":{\"Type\":\"Wait\",\"Seconds\":30,\"Next\":\"Check Stack Status\"},\"DeletionSuccessful?\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.checkResult.status\",\"StringEquals\":\"DELETE_FAILED\",\"Next\":\"UpdateFailureStatus\"}],\"Default\":\"Wait\"},\"UpdateFailureStatus\":{\"End\":true,\"Type\":\"Task\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:updateItem\",\"Parameters\":{\"Key\":{\"id\":{\"S.$\":\"$.repositoryId\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\",\"ExpressionAttributeNames\":{\"#status\":\"status\",\"#error\":\"error\"},\"ExpressionAttributeValues\":{\":status\":{\"S\":\"$.checkResult.status\"}},\"UpdateExpression\":\"SET #status = :status, #error = :error\"}},\"DeleteDynamoDbEntry\":{\"End\":true,\"Type\":\"Task\",\"ResultPath\":\"$.deleteDynamoDbResult\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::dynamodb:deleteItem\",\"Parameters\":{\"Key\":{\"repositoryId\":{\"S.$\":\"$.repositoryId\"}},\"TableName\":\"",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Fn::Select": [
                          5,
                          {
                            "Fn::Split": [
                              ":",
                              {
                                "Fn::GetAtt": [
                                  "RagRepositoryConfigTable6FA366CB",
                                  "Arn"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              },
              "\"}},\"CleanupRepositoryDocsRetry\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"OutputPath\":\"$.Payload\",\"Resource\":\"arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",
              {
                "Fn::GetAtt": [
                  "VectorStoreCreatorStackDeleteStoreStateMachineCleanupRepositoryDocsFuncB129B35B",
                  "Arn"
                ]
              },
              "\",\"Payload\":{\"repositoryId.$\":\"$.repositoryId\",\"lastEvaluated.$\":\"$.lastEvaluated\",\"stackName.$\":\"$.stackName\"}}}}}"
            ]
          ]
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "VectorStoreCreatorStacktestlisadevStateMachineRoleC93BE6D8",
            "Arn"
          ]
        },
        "StateMachineType": "STANDARD"
      },
      "DependsOn": [
        "VectorStoreCreatorStacktestlisadevStateMachineRoleDefaultPolicyDF7CE587",
        "VectorStoreCreatorStacktestlisadevStateMachineRoleC93BE6D8"
      ],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "VectorStoreCreatorStackDeleteStoreStateMachinedevtestlisalisaVectorStoreCreatorDelete71860FC7": {
      "Type": "AWS::SSM::Parameter",
      "Properties": {
        "Name": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
        "Type": "String",
        "Value": {
          "Ref": "VectorStoreCreatorStackDeleteStoreStateMachine70A7FD86"
        }
      }
    },
    "VectorStoreCreatorStackDeleteStoreStateMachineStateMachineExecutePolicy17D4BD44": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "VectorStoreCreatorStackDeleteStoreStateMachine70A7FD86"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "RagVectorStoreStateMachineDeleteExec",
        "Roles": [
          {
            "Fn::Select": [
              1,
              {
                "Fn::Split": [
                  "/",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          ":",
                          {
                            "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    "RepositoryApiRestApirepository40CDFF92": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputFnGetAttLisaApiBaseRestApiBD7EFE41RootResourceId15433D4A"
        },
        "PathPart": "repository",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryOPTIONSEB79C10E": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepository40CDFF92"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryGETApiPermissionLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryE35A7094": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorylistall7B1FB82C",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/GET/repository"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryGETApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FGETrepository8DD0591A": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorylistall7B1FB82C",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/GET/repository"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryGETE71A6DCF": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorylistall7B1FB82C",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepository40CDFF92"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositorystatusD1253A39": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepository40CDFF92"
        },
        "PathPart": "status",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositorystatusOPTIONS11CF4306": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositorystatusD1253A39"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositorystatusGETApiPermissionLisaRAGRepositoryApiRestApi0AD1924FGETrepositorystatusCE79B4BC": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositoryliststatus7E4D9E23",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/GET/repository/status"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositorystatusGETApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FGETrepositorystatus9089F258": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositoryliststatus7E4D9E23",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/GET/repository/status"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositorystatusGET3B80D731": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositoryliststatus7E4D9E23",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositorystatusD1253A39"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositorypresignedurlE2569778": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepository40CDFF92"
        },
        "PathPart": "presigned-url",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositorypresignedurlOPTIONS1F38581E": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositorypresignedurlE2569778"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositorypresignedurlPOSTApiPermissionLisaRAGRepositoryApiRestApi0AD1924FPOSTrepositorypresignedurl95C378D7": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorypresignedurlBBDFFDED",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/POST/repository/presigned-url"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositorypresignedurlPOSTApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FPOSTrepositorypresignedurlB6CF6C72": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorypresignedurlBBDFFDED",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/POST/repository/presigned-url"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositorypresignedurlPOST17EF9A79": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorypresignedurlBBDFFDED",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositorypresignedurlE2569778"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryPOSTApiPermissionLisaRAGRepositoryApiRestApi0AD1924FPOSTrepositoryBD24588A": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorycreate82D293D2",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/POST/repository"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryPOSTApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FPOSTrepositoryD5697015": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorycreate82D293D2",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/POST/repository"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryPOSTA1F97EAB": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorycreate82D293D2",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepository40CDFF92"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepository40CDFF92"
        },
        "PathPart": "{repositoryId}",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdOPTIONSE01318F5": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdDELETEApiPermissionLisaRAGRepositoryApiRestApi0AD1924FDELETErepositoryrepositoryId8CB5AA1E": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydelete061FD77D",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/DELETE/repository/*"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdDELETEApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FDELETErepositoryrepositoryId4070BF82": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydelete061FD77D",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/DELETE/repository/*"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdDELETE85130C2F": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "DELETE",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorydelete061FD77D",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdindex1CB71362": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "PathPart": "index",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdindexOPTIONSAF471628": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdindex1CB71362"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdindexmodelNameF5C83975": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdindex1CB71362"
        },
        "PathPart": "{modelName}",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdindexmodelNameOPTIONSC4CEAE19": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdindexmodelNameF5C83975"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdindexmodelNameDELETEApiPermissionLisaRAGRepositoryApiRestApi0AD1924FDELETErepositoryrepositoryIdindexmodelNameE30CA7DF": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydeleteindex018A1DE0",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/DELETE/repository/*/index/*"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdindexmodelNameDELETEApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FDELETErepositoryrepositoryIdindexmodelName8A911DBB": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydeleteindex018A1DE0",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/DELETE/repository/*/index/*"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdindexmodelNameDELETED7CAF702": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "DELETE",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorydeleteindex018A1DE0",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdindexmodelNameF5C83975"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdsimilaritySearch878A5EDB": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "PathPart": "similaritySearch",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdsimilaritySearchOPTIONSB527587F": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdsimilaritySearch878A5EDB"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdsimilaritySearchGETApiPermissionLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIdsimilaritySearch62BE8AAF": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorysimilaritysearch4A105094",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/GET/repository/*/similaritySearch"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdsimilaritySearchGETApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIdsimilaritySearch597BDB46": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorysimilaritysearch4A105094",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/GET/repository/*/similaritySearch"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdsimilaritySearchGETD74E26BD": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorysimilaritysearch4A105094",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdsimilaritySearch878A5EDB"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdbulkE48A131B": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "PathPart": "bulk",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdbulkOPTIONS74A6CA91": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdbulkE48A131B"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdbulkPOSTApiPermissionLisaRAGRepositoryApiRestApi0AD1924FPOSTrepositoryrepositoryIdbulk09DC3AD9": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositoryingestdocumentsD194F7BE",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/POST/repository/*/bulk"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdbulkPOSTApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FPOSTrepositoryrepositoryIdbulk7D8FEED7": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositoryingestdocumentsD194F7BE",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/POST/repository/*/bulk"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdbulkPOSTDAAF0143": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositoryingestdocumentsD194F7BE",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdbulkE48A131B"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentE33A2713": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "PathPart": "document",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentOPTIONSAFF04374": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIddocumentE33A2713"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentGETApiPermissionLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIddocument4F1802E4": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorylistdocs0127CF73",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/GET/repository/*/document"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentGETApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIddocumentDD70EEF0": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorylistdocs0127CF73",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/GET/repository/*/document"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentGET7585AD1B": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorylistdocs0127CF73",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIddocumentE33A2713"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentDELETEApiPermissionLisaRAGRepositoryApiRestApi0AD1924FDELETErepositoryrepositoryIddocumentA11EC982": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydeletedocuments4D39BB65",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/DELETE/repository/*/document"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentDELETEApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FDELETErepositoryrepositoryIddocument3149B8A9": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydeletedocuments4D39BB65",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/DELETE/repository/*/document"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentDELETE91841B98": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "DELETE",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorydeletedocuments4D39BB65",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIddocumentE33A2713"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentId9D9F1E60": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "PathPart": "{documentId}",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentIdOPTIONS1F7E9895": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIddocumentId9D9F1E60"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentIddownload4E8391B1": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIddocumentId9D9F1E60"
        },
        "PathPart": "download",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentIddownloadOPTIONS7A545475": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIddocumentIddownload4E8391B1"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentIddownloadGETApiPermissionLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIddocumentIddownloadD841D661": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydownloaddocument5BF87366",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/GET/repository/*/*/download"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentIddownloadGETApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIddocumentIddownload8C3C0799": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorydownloaddocument5BF87366",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/GET/repository/*/*/download"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIddocumentIddownloadGETF4309BA2": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorydownloaddocument5BF87366",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIddocumentIddownload4E8391B1"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdjobs47FDE3A4": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryId4FB9DAF5"
        },
        "PathPart": "jobs",
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdjobsOPTIONS1CC42C85": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
              },
              "StatusCode": "204"
            }
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }"
          },
          "Type": "MOCK"
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Allow-Methods": true
            },
            "StatusCode": "204"
          }
        ],
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdjobs47FDE3A4"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdjobsGETApiPermissionLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIdjobs578C606D": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorylistjobs49FA647F",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/*/GET/repository/*/jobs"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdjobsGETApiPermissionTestLisaRAGRepositoryApiRestApi0AD1924FGETrepositoryrepositoryIdjobs41A39759": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RepositoryApiLisaRAGrepositorylistjobs49FA647F",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:us-iso-east-1:012345678901:",
              {
                "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
              },
              "/test-invoke-stage/GET/repository/*/jobs"
            ]
          ]
        }
      }
    },
    "RepositoryApiRestApirepositoryrepositoryIdjobsGET245EAB42": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiAuthorizerAPIGWAuthorizerE7001880E41EC3EB"
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:us-iso-east-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RepositoryApiLisaRAGrepositorylistjobs49FA647F",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        },
        "ResourceId": {
          "Ref": "RepositoryApiRestApirepositoryrepositoryIdjobs47FDE3A4"
        },
        "RestApiId": {
          "Fn::ImportValue": "LisaApiBase:ExportsOutputRefLisaApiBaseRestApiBD7EFE4112A65F2C"
        }
      }
    },
    "RepositoryApiLisaRAGrepositorylistall7B1FB82C": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "List all repositories",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-list_all",
        "Handler": "repository.lambda_functions.list_all",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositoryliststatus7E4D9E23": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "List status for all repositories",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-list_status",
        "Handler": "repository.lambda_functions.list_status",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorypresignedurlBBDFFDED": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Generates a presigned url for uploading files to RAG",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-presigned_url",
        "Handler": "repository.lambda_functions.presigned_url",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorycreate82D293D2": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Create a new repository",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-create",
        "Handler": "repository.lambda_functions.create",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorydelete061FD77D": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Delete a repository",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-delete",
        "Handler": "repository.lambda_functions.delete",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorydeleteindex018A1DE0": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Delete an index within a repository",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-delete_index",
        "Handler": "repository.lambda_functions.delete_index",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorysimilaritysearch4A105094": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Run a similarity search against the specified repository using the specified query",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-similarity_search",
        "Handler": "repository.lambda_functions.similarity_search",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositoryingestdocumentsD194F7BE": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Ingest a set of documents based on specified S3 path",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-ingest_documents",
        "Handler": "repository.lambda_functions.ingest_documents",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorylistdocs0127CF73": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "List all docs for a repository",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-list_docs",
        "Handler": "repository.lambda_functions.list_docs",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorydownloaddocument5BF87366": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Creates presigned url to download document within repository",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-download_document",
        "Handler": "repository.lambda_functions.download_document",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorydeletedocuments4D39BB65": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "Deletes all records associated with documents from the repository",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-delete_documents",
        "Handler": "repository.lambda_functions.delete_documents",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    },
    "RepositoryApiLisaRAGrepositorylistjobs49FA647F": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-012345678901-us-iso-east-1",
          "S3Key": "d30f155d17212cea93e902d5495d00068001aaa2488e43708bd159abd0871b7a.zip"
        },
        "Description": "List all ingestion jobs for a repository",
        "Environment": {
          "Variables": {
            "ADMIN_GROUP": "",
            "BUCKET_NAME": {
              "Ref": "LISARAGtestlisadevFF387D45"
            },
            "CHUNK_OVERLAP": "51",
            "CHUNK_SIZE": "512",
            "LISA_API_URL_PS_NAME": "/dev/test-lisa/lisa/lisaServeRestApiUri",
            "LOG_LEVEL": "DEBUG",
            "MANAGEMENT_KEY_SECRET_NAME_PS": "/dev/test-lisa/lisa/managementKeySecretName",
            "MODEL_TABLE_NAME": {
              "Ref": "LisaRAGResourcesModelTableNameStringParameterParameter9C4F30B2"
            },
            "RAG_DOCUMENT_TABLE": {
              "Ref": "testlisaRagDocumentTable5A134785"
            },
            "RAG_SUB_DOCUMENT_TABLE": {
              "Ref": "testlisaRagSubDocumentTable76E4AE52"
            },
            "REGISTERED_MODELS_PS_NAME": "/dev/test-lisa/lisa/registeredModels",
            "REGISTERED_REPOSITORIES_PS_PREFIX": "/dev/test-lisa/lisa/LisaServeRagConnectionInfo/",
            "REGISTERED_REPOSITORIES_PS": "/dev/test-lisa/lisa/registeredRepositories",
            "REST_API_VERSION": "v2",
            "TIKTOKEN_CACHE_DIR": "/opt/python/TIKTOKEN_CACHE",
            "RESTAPI_SSL_CERT_ARN": "arn:aws:iam::012345678901:server-certificate/lisa-self-signed-dev",
            "LISA_RAG_VECTOR_STORE_TABLE": {
              "Ref": "RagRepositoryConfigTable6FA366CB"
            },
            "LISA_RAG_CREATE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/create",
            "LISA_RAG_DELETE_STATE_MACHINE_ARN_PARAMETER": "/dev/test-lisa/lisa/vectorstorecreator/statemachine/delete",
            "LISA_INGESTION_JOB_TABLE_NAME": {
              "Ref": "IngestionStackConstructIngestionJobTable8103D8C1"
            },
            "LISA_INGESTION_JOB_QUEUE_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Fn::GetAtt": [
                                "IngestionStackConstructIngestionJobQueueCECF0CDA",
                                "JobQueueArn"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            "LISA_INGESTION_JOB_DEFINITION_NAME": {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "/",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "IngestionStackConstructIngestionJobDefinition529FE179"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        },
        "FunctionName": "LisaRAG-repository-list_jobs",
        "Handler": "repository.lambda_functions.list_jobs",
        "Layers": [
          {
            "Ref": "RagLayerF72F34A6"
          },
          {
            "Ref": "SsmParameterValuedevtestlisalisalayerVersioncommonC96584B6F00A464EAD1953AFF4B05118Parameter"
          }
        ],
        "MemorySize": 512,
        "Role": {
          "Ref": "SsmParameterValuedevtestlisalisarolestestlisaLisaRagLambdaExecutionRoleC96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "Runtime": "python3.11",
        "Timeout": 180,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputFnGetAttVpcLambdaSecurityGroup184B54BDGroupIdB1374FFB"
            }
          ],
          "SubnetIds": [
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet1Subnet29B9FADC0739E75F"
            },
            {
              "Fn::ImportValue": "LisaNetworking:ExportsOutputRefVpcVPCprivateSubnet2Subnet63498DC142E639BD"
            }
          ]
        }
      },
      "DependsOn": [
        "LisaRAGResourcesLisaRagLambdaExecutionRolePolicy1F0EBC60"
      ]
    }
  },
  "Outputs": {
    "ragVectorStoreTable": {
      "Value": {
        "Fn::GetAtt": [
          "RagRepositoryConfigTable6FA366CB",
          "Arn"
        ]
      }
    }
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5"
                  ],
                  {
                    "Ref": "BootstrapVersion"
                  }
                ]
              }
            ]
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
        }
      ]
    }
  }
}
